syntax "next-router/0.1";

provider "uniaix" {
  defaults {
    upstream_config {
      # Gemini native base URL
      base_url = "https://www.uniaix.com";
    }
    auth {
      auth_bearer;
    }
    response {
      resp_passthrough;
    }
    metrics {
      usage_extract openai;
    }
  }

  match api = "chat.completions" {
    upstream {
      set_path "/v1/chat/completions";
    }
  }

  match api = "completions" {
    upstream {
      set_path "/v1/completions";
    }
  }

  match api = "responses" {
    upstream {
      set_path "/v1/responses";
    }
  }

  match api = "embeddings" {
    upstream {
      set_path "/v1/embeddings";
    }
  }

  match api = "claude.messages" {
    upstream {
      set_path "/v1/messages";
    }
    # Compatibility: some clients send OpenAI-style stream_options; Anthropic /v1/messages rejects it.
    request {
      json_del "$.stream_options";
    }
    metrics {
      usage_extract anthropic;
    }
  }

  match api = "gemini.generateContent" {
    upstream {
      set_path concat("/v1beta/models/", $request.model_mapped, ":generateContent");
    }
    metrics {
      usage_extract gemini;
    }
  }

  match api = "gemini.streamGenerateContent" {
    upstream {
      set_path concat("/v1beta/models/", $request.model_mapped, ":streamGenerateContent");
      set_query alt "sse";
    }
    metrics {
      usage_extract gemini;
    }
  }
}
